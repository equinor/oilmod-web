<div
  [class.sto-mdl-table--force-width]="columnMode === ColumnDisplay.Force"
  [style.height.px]="height$ | async"
  class="sto-mdl-table"
  role="table"
>
  <ng-content select="sto-datatable-actions"></ng-content>
  @if (
    (!responsive || (responsive && !smallScreen)) &&
    columnGroups() &&
    this.scrollbarH()
  ) {
    <sto-datatable-header-group
      [columns]="columns"
      [groups]="columnGroups()"
      [height]="headerHeight()"
      [transform]="scrollLeft"
      [width]="width"
    ></sto-datatable-header-group>
  }
  <sto-datatable-header
    (headerContextMenu)="headerContextMenu.emit($event)"
    (resized)="onResize($event)"
    (sort)="sort($event)"
    [bodyHeight]="bodyHeight"
    [columnMode]="columnMode"
    [activeSort]="activeSort"
    [columns]="columns"
    [groups]="groups()"
    [headerHeight]="headerHeight()"
    [offset]="bodyHeight && rowTotalHeight > bodyHeight ? 12 : 0"
    [resizeable]="resizeable && scrollbarH()"
    [responsive]="responsive"
    [rowHeight]="rowHeight()"
    [rows]="rows"
    [scrollLeft]="scrollLeft"
    [smallScreen]="smallScreen"
    [sortable]="sortable()"
    [width]="width"
  ></sto-datatable-header>
  @if (loading()) {
    <div class="sto-mdl-table__progress-bar" role="progressbar">
      <div class="sto-mdl-table__progress-bar__container">
        <div class="sto-mdl-table__progress-bar__container__bar"></div>
      </div>
    </div>
  }
  @if (!rows || rows.length === 0) {
    <div class="sto-mdl-table__body--empty">
      {{ emptyMessage() }}
    </div>
  }
  <sto-datatable-body
    #body
    (activate)="rowActivate.emit($event)"
    (rowContextMenu)="rowContextMenu.emit($event)"
    (rowSelected)="select.emit($event)"
    (scrollHeader)="setHeaderScroll($event)"
    [columnMode]="columnMode"
    [columns]="columns"
    [disableRipple]="disableRipple() || select.observers.length === 0"
    [hasFooter]="!!footerRow"
    [height]="bodyHeight"
    [responsiveView]="responsiveView()"
    [responsive]="responsive"
    [rowClass]="rowClass()"
    [rowHeight]="rowHeight()"
    [rows]="rows"
    [scrollLeft]="scrollbarH() && footerRow ? scrollLeft : null"
    [scrollbarH]="footerRow ? false : scrollbarH()"
    [selectable]="!!select.observers.length"
    [selected]="selected()"
    [selectionMode]="selectionMode()"
    [smallView]="smallScreen"
    [trackBy]="trackBy()"
    [virtualScroll]="virtualScroll()"
    [width]="scrollbarH() ? columnTotalWidth + 'px' : 'auto'"
  ></sto-datatable-body>
  @if (footerRow && (!responsive || (responsive && !smallScreen))) {
    <div
      (scroll)="scrollBodyAndHeader($event)"
      [style.overflowX]="'auto'"
      [style.overflowY]="'hidden'"
      [style.width]="'calc(100% - ' + body.verticalScrollOffset() + 'px)'"
      class="sto-mdl-table__footer"
    >
      @for (row of footerRow; track row; let i = $index) {
        <div
          [class.sto-mdl-table__row--scroll-offset]="
            scrollbarH() &&
            !!bodyHeight &&
            (rows?.length || 1) * rowHeight() > bodyHeight
          "
          [style.height.px]="rowHeight()"
          [style.min-width]="width"
          [style.overflowY]="'hidden'"
          class="sto-mdl-table__footer__row"
        >
          @for (column of columns; track trackColumnsFn($index, column)) {
            <div
              [ngStyle]="column | columnStyle: columnMode"
              class="sto-mdl-table__footer__row__cell"
            >
              @if (!column.footerTemplate) {
                <span>
                  {{ row[column.prop] }}
                </span>
              }
              @if (column.footerTemplate) {
                <ng-template
                  #footerTemplate
                  [ngTemplateOutletContext]="{
                    column: column,
                    value: row[column.prop],
                    index: i,
                  }"
                  [ngTemplateOutlet]="column.footerTemplate"
                >
                </ng-template>
              }
            </div>
          }
        </div>
      }
    </div>
  }
</div>
<ng-content select="mat-paginator"></ng-content>
